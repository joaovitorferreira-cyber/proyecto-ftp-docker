services:
  # Servidor LDAP (Directori Actiu Independent)
  ldap:
    image: osixia/openldap:latest
    container_name: ldap-granalmacen
    environment:
      LDAP_ORGANISATION: "Gran Almacen"
      LDAP_DOMAIN: "granalmacen.com"
      LDAP_ADMIN_PASSWORD: "12345678"
    volumes:
      - ./ldap-server/database:/var/lib/ldap
      - ./ldap-server/config:/etc/ldap/slapd.d
    networks:
      ftp_net:
        ipv4_address: 192.168.144.185
    restart: always

  # Servidor FTP amb m√≤dul PAM-LDAP
  ftp-ldap:
    build:
      context: ..
      dockerfile: ftp.Dockerfile
    container_name: ftp-granalmacen-ldap
    depends_on:
      - ldap
    ports:
      - "21:21"
      - "21100-21110:21100-21110"
    volumes:
      - ./vsftpd.conf:/etc/vsftpd/vsftpd.conf:ro
      - ./pam_vsftpd:/etc/pam.d/vsftpd:ro
      - ./ldap.conf:/etc/ldap.conf:ro # Configurat per apuntar a la .185
      - ../certs/vsftpd.pem:/etc/ssl/private/vsftpd.pem:ro
      - ./data:/home:rw
    networks:
      ftp_net:
        ipv4_address: 192.168.144.183
    restart: always

networks:
  ftp_net:
    external: true